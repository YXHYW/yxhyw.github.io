"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7178],{30708:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var r=s(74848),t=s(28453);const i={sidebar_position:3},a=void 0,o={id:"python/FastAPI/\u57fa\u7840/\u5feb\u901f\u5165\u95e8",title:"\u5feb\u901f\u5165\u95e8",description:"helloworld",source:"@site/docs/python/FastAPI/\u57fa\u7840/\u5feb\u901f\u5165\u95e8.md",sourceDirName:"python/FastAPI/\u57fa\u7840",slug:"/python/FastAPI/\u57fa\u7840/\u5feb\u901f\u5165\u95e8",permalink:"/docs/python/FastAPI/\u57fa\u7840/\u5feb\u901f\u5165\u95e8",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"python",previous:{title:"\u6280\u80fd\u56fe\u8c31",permalink:"/docs/python/FastAPI/\u57fa\u7840/\u6280\u80fd\u56fe\u8c31"},next:{title:"\u5f02\u5e38\u5904\u7406",permalink:"/docs/category/\u5f02\u5e38\u5904\u7406"}},l={},d=[{value:"helloworld",id:"helloworld",level:2},{value:"wrk\u6d4b\u8bd5",id:"wrk\u6d4b\u8bd5",level:2},{value:"\u591a\u4e2a\u88c5\u9970\u5668\u88c5\u9970\u4e00\u4e2a\u89c6\u56fe\u51fd\u6570",id:"\u591a\u4e2a\u88c5\u9970\u5668\u88c5\u9970\u4e00\u4e2a\u89c6\u56fe\u51fd\u6570",level:2},{value:"\u4e00\u4e2aURL\u914d\u7f6e\u591a\u4e2aHTTP\u8bf7\u6c42\u65b9\u6cd5",id:"\u4e00\u4e2aurl\u914d\u7f6e\u591a\u4e2ahttp\u8bf7\u6c42\u65b9\u6cd5",level:2},{value:"\u5904\u7406\u8def\u5f84\u53c2\u6570",id:"\u5904\u7406\u8def\u5f84\u53c2\u6570",level:2},{value:"\u5904\u7406\u542b\u6709\u6587\u4ef6\u8def\u5f84\u7684\u8def\u5f84\u53c2\u6570",id:"\u5904\u7406\u542b\u6709\u6587\u4ef6\u8def\u5f84\u7684\u8def\u5f84\u53c2\u6570",level:2},{value:"\u679a\u4e3e\u8def\u5f84\u53c2\u6570",id:"\u679a\u4e3e\u8def\u5f84\u53c2\u6570",level:2},{value:"\u5904\u7406\u67e5\u8be2\u53c2\u6570",id:"\u5904\u7406\u67e5\u8be2\u53c2\u6570",level:2},{value:"\u5904\u7406JSON\u8bf7\u6c42\u4f53\u53c2\u6570",id:"\u5904\u7406json\u8bf7\u6c42\u4f53\u53c2\u6570",level:2},{value:"\u7b80\u5355\u952e\u503c\u8bf7\u6c42\u4f53",id:"\u7b80\u5355\u952e\u503c\u8bf7\u6c42\u4f53",level:3},{value:"\u4e8c\u5c42\u5d4c\u5957",id:"\u4e8c\u5c42\u5d4c\u5957",level:3},{value:"\u5305\u542b\u5217\u8868\u7684\u591a\u5c42\u5d4c\u5957",id:"\u5305\u542b\u5217\u8868\u7684\u591a\u5c42\u5d4c\u5957",level:3},{value:"\u5904\u7406\u8868\u5355\u8bf7\u6c42\u53c2\u6570",id:"\u5904\u7406\u8868\u5355\u8bf7\u6c42\u53c2\u6570",level:2},{value:"\u63a5\u6536\u6587\u4ef6\u4e0a\u4f20",id:"\u63a5\u6536\u6587\u4ef6\u4e0a\u4f20",level:2},{value:"\u5904\u7406\u8bf7\u6c42\u5934\u53c2\u6570",id:"\u5904\u7406\u8bf7\u6c42\u5934\u53c2\u6570",level:2},{value:"\u5904\u7406cookie\u53c2\u6570",id:"\u5904\u7406cookie\u53c2\u6570",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"helloworld",children:"helloworld"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# main.py\nfrom fastapi import FastAPI\nimport uvicorn\n\napp = FastAPI()\n\n@app.get("/")\ndef index():\n    return {"Hello": "world"}\n\nif __name__ == \'__main__\':\n    # main:app \u4e2d\u7684 main \u6307\u4ee3\u7801\u6587\u4ef6 main.py\n    uvicorn.run(app="main:app",host="127.0.0.1",port=8000)\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd0\u884c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"python main.py\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Swagger\u6587\u6863\u5730\u5740\uff1a",(0,r.jsx)(n.code,{children:"http://127.0.0.1:8000/docs"})]}),"\n",(0,r.jsxs)(n.li,{children:["ReDoc\u6587\u6863\u5730\u5740\uff1a",(0,r.jsx)(n.code,{children:"http://127.0.0.1:8000/redoc"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"wrk\u6d4b\u8bd5",children:"wrk\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Running 30s test @ http://127.0.0.1:8000\n  6 threads and 500 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   155.60ms   16.76ms 227.92ms   71.30%\n    Req/Sec   534.25    109.46   838.00     68.85%\n  95940 requests in 30.10s, 12.99MB read\nRequests/sec:   3187.74\nTransfer/sec:    442.05KB\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u591a\u4e2a\u88c5\u9970\u5668\u88c5\u9970\u4e00\u4e2a\u89c6\u56fe\u51fd\u6570",children:"\u591a\u4e2a\u88c5\u9970\u5668\u88c5\u9970\u4e00\u4e2a\u89c6\u56fe\u51fd\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u4e00\u4e2a\u89c6\u56fe\u51fd\u6570\u9700\u8981\u540c\u65f6\u652f\u6301\u591a\u4e2a\u8bf7\u6c42\u5730\u5740\u7684\u8bbf\u95ee\uff0c\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u88c5\u9970\u5668\u88c5\u9970\u540c\u4e00\u4e2a\u89c6\u56fe\u51fd\u6570\u3002\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@app.get("/")\n@app.get("/index")\ndef root():\n    return {"msg": "hello world"}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e00\u4e2aurl\u914d\u7f6e\u591a\u4e2ahttp\u8bf7\u6c42\u65b9\u6cd5",children:"\u4e00\u4e2aURL\u914d\u7f6e\u591a\u4e2aHTTP\u8bf7\u6c42\u65b9\u6cd5"}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7",(0,r.jsx)(n.code,{children:"@app.api_route"}),"\u652f\u6301\u914d\u7f6e\u89c6\u56fe\u51fd\u6570\u4f7f\u7528\u4e0d\u540c\u7684HTTP\u8bf7\u6c42\u65b9\u6cd5"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@app.get("/", \n         tags=["test"],\n         summary="root url",\n         description="fastapi quickstart",\n         response_class=JSONResponse)\n@app.api_route("/index", methods=["GET", "POST"])\ndef index():\n    return {"msg": "Hello World"}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406\u8def\u5f84\u53c2\u6570",children:"\u5904\u7406\u8def\u5f84\u53c2\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'app = FastAPI()\n\n@app.get("/items/{item_id}")\nasync def read_item(item_id):\n\treturn {"item_id": item_id}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u58f0\u660e\u8def\u5f84\u53c2\u6570\u7684\u7c7b\u578b"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@app.get("/items/{item_id}")\nasync def read_item(item_id: int):\n\treturn {"item_id": item_id}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u5b58\u5728",(0,r.jsx)(n.code,{children:'@app.get("/items/item_id")'}),"\u548c",(0,r.jsx)(n.code,{children:'@app.get("/items/{item_id}")'}),"\u4e24\u6761\u8def\u7531\uff0c\u4e00\u4e2a\u9759\u6001\uff0c\u4e00\u4e2a\u52a8\u6001\u3002\u540c\u65f6\u8bbf\u95ee\u65f6",(0,r.jsx)(n.code,{children:'"/items/item_id"'}),"\u65f6\uff0c\u4f1a\u6309\u7167\u8c01\u5148\u5b9a\u4e49\u5c31\u4f18\u5148\u8bbf\u95ee\u8c01\u7684\u987a\u5e8f\u6765\u8bbf\u95ee\u3002\u5982\u679c\u5148\u5b9a\u4e49\u9759\u6001\u8def\u7531\uff0c\u5c31\u5148\u8bbf\u95ee\u9759\u6001\u8def\u7531\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406\u542b\u6709\u6587\u4ef6\u8def\u5f84\u7684\u8def\u5f84\u53c2\u6570",children:"\u5904\u7406\u542b\u6709\u6587\u4ef6\u8def\u5f84\u7684\u8def\u5f84\u53c2\u6570"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u8981\u6c42\u4f20\u5165\u7684\u8def\u5f84\u53c2\u6570\u662f\u4e00\u79cd\u6587\u4ef6\u8def\u5f84\uff0c\u9700\u8981\u5c06\u8def\u5f84\u53c2\u6570\u58f0\u660e\u4e3a",(0,r.jsx)(n.code,{children:"path"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@app.get("/{filepath:path}")\nasync def filepath_param(filepath: str):\n    return {"filepath": filepath}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u679a\u4e3e\u8def\u5f84\u53c2\u6570",children:"\u679a\u4e3e\u8def\u5f84\u53c2\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u5047\u8bbe\u8def\u5f84\u53c2\u6570\u6709\u51e0\u4e2a\u9884\u8bbe\u503c\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u5f15\u5165\u679a\u4e3e\u7c7b\u5b9a\u4e49\u8def\u5f84\u53c2\u6570\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from enum import Enum\n\nclass CityEnum(str, Enum):\n    beijing = "beijing"\n    shanghai = "shanghai"\n    guangzhou = "guangzhou"\n    shenzhen = "shenzhen"\n\n@router.get("/city/{cityname}", summary="\u679a\u4e3e\u57ce\u5e02\u540d\u79f0")\nasync def get_city_info(cityname: CityEnum):\n    if cityname == CityEnum.beijing:\n        return {"city": "\u5317\u4eac", "country": "\u4e2d\u56fd"}\n    elif cityname == CityEnum.shanghai:\n        return {"city": "\u4e0a\u6d77", "country": "\u4e2d\u56fd"}\n    elif cityname == CityEnum.guangzhou:\n        return {"city": "\u5e7f\u5dde", "country": "\u4e2d\u56fd"}\n    elif cityname == CityEnum.shenzhen:\n        return {"city": "\u6df1\u5733", "country": "\u4e2d\u56fd"}\n    else:\n        return {"city": "\u672a\u77e5", "country": "\u672a\u77e5"}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406\u67e5\u8be2\u53c2\u6570",children:"\u5904\u7406\u67e5\u8be2\u53c2\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0b\u793a\u4f8b\u4e2d\u4e3aapi\u8bbe\u7f6e\u4e24\u4e2a\u67e5\u8be2\u53c2\u6570\uff0c\u5e76\u6307\u5b9a\u9ed8\u8ba4\u503c\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u503c\uff0c\u53c2\u6570\u5c06\u4e3a\u5fc5\u9700\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import FastAPI\n\napp = FastAPI()\n\nfake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]\n\n\n@app.get("/items/")\nasync def read_item(skip: int = 0, limit: int = 10):\n    return fake_items_db[skip : skip + limit]\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u8bf7\u6c42\u793a\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"curl http://127.0.0.1:8000/items/?skip=0&limit=10\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u9664\u4e86\u8bbe\u7f6e\u9ed8\u8ba4\u503c\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u53c2\u6570\u4e3a\u53ef\u9009\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from typing import Union\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get("/items/{item_id}")\nasync def read_item(item_id: str, q: Union[str, None] = None):\n    if q:\n        return {"item_id": item_id, "q": q}\n    return {"item_id": item_id}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406json\u8bf7\u6c42\u4f53\u53c2\u6570",children:"\u5904\u7406JSON\u8bf7\u6c42\u4f53\u53c2\u6570"}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u91cc\u4f7f\u7528\u8def\u7531\u7ec4\u6765\u7ec4\u7ec7\u4ee3\u7801\uff0c",(0,r.jsx)(n.code,{children:"myfastapi/main.py"}),"\u5185\u5bb9\u5982\u4e0b\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import FastAPI\n\napp = FastAPI(\n    title="Hello FastAPI",\n    description="Quickstart of FastAPI",\n    version="0.1.0",\n)\n\n# \u6ce8\u518c\u8def\u7531\u7ec4\nfrom routes import jsonbody\napp.include_router(jsonbody.router)\n\nif __name__ == "__main__":\n    import uvicorn\n    uvicorn.run(app="main:app", host="127.0.0.1", port=8000)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u521b\u5efa",(0,r.jsx)(n.code,{children:"myfastapi/models"}),"\u548c",(0,r.jsx)(n.code,{children:"myfastapi/routes"}),"\u6587\u4ef6\u5939\uff0c\u5728\u4e24\u4e2a\u6587\u4ef6\u4e0b\u521b\u5efa\u5185\u5bb9\u7a7a\u767d\u7684",(0,r.jsx)(n.code,{children:"__init__.py"}),"\u6587\u4ef6\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b80\u5355\u952e\u503c\u8bf7\u6c42\u4f53",children:"\u7b80\u5355\u952e\u503c\u8bf7\u6c42\u4f53"}),"\n",(0,r.jsx)(n.p,{children:"\u8bf7\u6c42\u4f53\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "username": "string",\n  "password": "string",\n  "age": 0,\n  "address": "string"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u7f16\u8f91",(0,r.jsx)(n.code,{children:"myfastapi/models/reqresp.py"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from pydantic import BaseModel\nfrom typing import Optional\n\nclass ReqBody1(BaseModel):\n    username: str\n    password: str\n    age: int\n    address: Optional[str] = None\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7f16\u8f91",(0,r.jsx)(n.code,{children:"myfastapi/routes/jsonbody.py"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import APIRouter\nfrom models import reqresp\nfrom starlette.responses import JSONResponse\n\nrouter = APIRouter(prefix="/jsonbody", tags=["\u89e3\u6790json\u8bf7\u6c42\u4f53"])\n\n@router.post("/test1", summary="\u6d4b\u8bd5\u89e3\u6790json\u8bf7\u6c421")\ndef jtest1(req: reqresp.ReqBody1):\n    return JSONResponse({\n        "code": 200,\n        "data": {\n            "username": req.username,\n            "age": req.age,\n        }\n    })\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u6d4b\u8bd5\u54cd\u5e94\u7ed3\u679c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "code": 200,\n  "data": {\n    "username": "string",\n    "age": 0\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e5f\u53ef\u4ee5\u4f7f\u7528",(0,r.jsx)(n.code,{children:"fastapi.Body"}),"\u7c7b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import Body\n@router.post("/test2", summary="\u6d4b\u8bd5\u89e3\u6790json\u8bf7\u6c422")\ndef jtest2(\n    username: str = Body(...), # \u5fc5\u586b\n    password: str = Body(...), # \u5fc5\u586b\n    age: int = Body(..., ge=0), # \u5927\u4e8e\u7b49\u4e8e0\n    address: str = Body(default=None), # \u53ef\u9009\u5b57\u6bb5\n):\n    return {\n        "username": username,\n        "age": age,\n    }\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4e8c\u5c42\u5d4c\u5957",children:"\u4e8c\u5c42\u5d4c\u5957"}),"\n",(0,r.jsx)(n.p,{children:"\u8bf7\u6c42\u4f53\u793a\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "user": {\n    "username": "string",\n    "sex": "string",\n    "age": 0\n  },\n  "job": {\n    "name": "string",\n    "job_no": 0,\n    "dept_no": 0\n  },\n  "company": "string"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u7f16\u8f91",(0,r.jsx)(n.code,{children:"models/reqresp.py"}),"\uff0c\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class ReqBody3_User(BaseModel):\n    username: str\n    sex: str\n    age: int\n\nclass ReqBody3_Job(BaseModel):\n    name: str\n    job_no: int\n    dept_no: int\n\nclass ReqBody3(BaseModel):\n    user: ReqBody3_User\n    job: ReqBody3_Job\n    company: str\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7f16\u8f91",(0,r.jsx)(n.code,{children:"routes/jsonbody.py"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@router.post("/test3", summary="\u6d4b\u8bd5\u89e3\u6790json\u8bf7\u6c423")\ndef jtest3(req: reqresp.ReqBody3):\n    return req\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u5305\u542b\u5217\u8868\u7684\u591a\u5c42\u5d4c\u5957",children:"\u5305\u542b\u5217\u8868\u7684\u591a\u5c42\u5d4c\u5957"}),"\n",(0,r.jsx)(n.p,{children:"\u8bf7\u6c42\u4f53"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "receiver": "string",\n  "status": "string",\n  "alerts": [\n    {\n      "status": "string",\n      "labels": {\n        "alertname": "string",\n        "instance": "string",\n        "job": "string",\n        "severity": "string"\n      },\n      "annotations": {\n        "description": "string",\n        "summary": "string"\n      },\n      "startsAt": "string",\n      "endsAt": "string",\n      "generatorURL": "string",\n      "fingerprint": "string"\n    }\n  ],\n  "groupLabels": {\n    "alertname": "string"\n  },\n  "commonLabels": {\n    "alertname": "string",\n    "instance": "string",\n    "job": "string",\n    "severity": "string"\n  },\n  "externalURL": "string",\n  "version": "string",\n  "groupKey": "string",\n  "truncatedAlerts": 0,\n  "tags": []\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u7f16\u8f91",(0,r.jsx)(n.code,{children:"models/reqresp.py"}),"\uff0c\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class Req4_alerts_labels(BaseModel):\n    alertname: str\n    instance: str\n    job: str\n    severity: str\n\nclass Req4_alerts_annotations(BaseModel):\n    description: str\n    summary: str\n\nclass Req4_alerts(BaseModel):\n    status: str\n    labels: Req4_alerts_labels\n    annotations: Req4_alerts_annotations\n    startsAt: str\n    endsAt: str\n    generatorURL: str\n    fingerprint: str\n\nclass Req4_grouplabels(BaseModel):\n    alertname: str\n\nclass Req4_commonlabels(BaseModel):\n    alertname: str\n    instance: str\n    job: str\n    severity: str\n\nclass Req4_commonAnnotations(BaseModel):\n    description: str\n    summary: str\n\nclass ReqBody4(BaseModel):\n    receiver: str\n    status: str\n    alerts: List[Req4_alerts] # \u5217\u8868\u7c7b\u578b. from typing import List\n    groupLabels: Req4_grouplabels\n    commonLabels: Req4_commonlabels\n    externalURL: str\n    version: str\n    groupKey: str\n    truncatedAlerts: int\n    tags: Set[str] = [] # \u96c6\u5408\u7c7b\u578b, \u9ed8\u8ba4\u4e3a\u7a7a from typing import Set\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7f16\u8f91",(0,r.jsx)(n.code,{children:"routes/jsonbody.py"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@router.post("/test4", summary="\u6d4b\u8bd5\u89e3\u6790json\u8bf7\u6c424")\ndef jtest4(req: reqresp.ReqBody4):\n    return req\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406\u8868\u5355\u8bf7\u6c42\u53c2\u6570",children:"\u5904\u7406\u8868\u5355\u8bf7\u6c42\u53c2\u6570"}),"\n",(0,r.jsx)(n.p,{children:"FastAPI\u5904\u7406\u8868\u5355\u9700\u8981\u5b89\u88c5\u7b2c\u4e09\u65b9\u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python -m pip install python-multipart\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import Form\n\n@router.post("/form", summary="\u5904\u7406\u8868\u5355\u8bf7\u6c42\u53c2\u6570")\ndef formtest1(\n    username: str = Form(..., min_length=6, max_length=12),\n    password: str = Form(..., min_length=6, max_length=12),\n):\n    return {"username": username, "password": password}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u63a5\u6536\u6587\u4ef6\u4e0a\u4f20",children:"\u63a5\u6536\u6587\u4ef6\u4e0a\u4f20"}),"\n",(0,r.jsxs)(n.p,{children:["FastAPI\u63d0\u4f9b\u4e86",(0,r.jsx)(n.code,{children:"File"}),"\u7c7b\u548c",(0,r.jsx)(n.code,{children:"UploadFile"}),"\u4e24\u4e2a\u7c7b\u7528\u4e8e\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u3002File \u7c7b\u63a5\u6536\u5230\u7684\u5185\u5bb9\u662f\u6587\u4ef6\u5b57\u8282\uff0c\u65e0\u6cd5\u8bfb\u53d6\u5230\u6587\u4ef6\u540d\u7b49\u4fe1\u606f\uff0c\u4e00\u822c\u7528\u4e8e\u4e0a\u4f20\u5c0f\u6587\u4ef6\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u5f02\u6b65\u89c6\u56fe\u4e2d\uff0c\u901a\u8fc7\u5f15\u5165",(0,r.jsx)(n.code,{children:"aiofiles"}),"\u6765\u5f02\u6b65\u5199\u5165\u6587\u4ef6\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python -m pip install aiofiles\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import File, UploadFile\nfrom typing import List\n\n@router.post("/file1", summary="\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u8bf7\u6c42, File\u5f62\u5f0f")\ndef filetest1(file: bytes = File(...)):\n    """\n    \u4f7f\u7528File\u7c7b\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u8bf7\u6c42, \u6587\u4ef6\u5185\u5bb9\u4f1a\u4ee5bytes\u7c7b\u578b\u5199\u5165\u5185\u5b58, \u7528\u5e38\u7528\u4e8e\u4e0a\u4f20\u5c0f\u6587\u4ef6\n    """\n    with open("test.jpg", "wb") as f:\n        f.write(file)\n\n    return {\n        "msg": "\u4e0a\u4f20\u6210\u529f",\n        "filesize": len(file),\n    }\n\nimport aiofiles\n@router.post("/file2", summary="\u57fa\u4e8eFile\u7c7b, \u5f02\u6b65\u63a5\u6536")\nasync def filetest2(file: bytes = File(...)):\n    async with aiofiles.open("test.jpg", "wb") as f:\n        await f.write(file)\n    return {\n        "msg": "\u4e0a\u4f20\u6210\u529f",\n        "filesize": len(file),\n    }\n\n@router.post("/file3", summary="\u57fa\u4e8eFile\u7c7b, bytes\u65b9\u5f0f\u540c\u6b65\u63a5\u6536\u591a\u6587\u4ef6")\ndef filetest3(files: List[bytes] = File(...)):\n    return {"file_sizes": [len(file) for file in files]}\n\n\n@router.post("/file4", summary="\u57fa\u4e8eUploadFile\u7c7b\u63a5\u6536\u6587\u4ef6\u4e0a\u4f20")\nasync def filetest4(file: UploadFile = File(...)):\n    rst = {\n        "filename": file.filename,\n        "content_type": file.content_type,\n    }\n    content = await file.read()\n    with open(f"{file.filename}", "wb") as f:\n        f.write(content)\n    return rst\n\n@router.post("/file5", summary="\u57fa\u4e8eUploadFile\u7c7b\u63a5\u6536\u591a\u6587\u4ef6\u4e0a\u4f20")\nasync def filetest5(files: List[UploadFile] = File(...)):\n    return {filename: filesize for filename,filesize in zip([f1.filename for f1 in files],[len(await f2.read()) for f2 in files])}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406\u8bf7\u6c42\u5934\u53c2\u6570",children:"\u5904\u7406\u8bf7\u6c42\u5934\u53c2\u6570"}),"\n",(0,r.jsxs)(n.p,{children:["fastapi\u63d0\u4f9b\u4e86",(0,r.jsx)(n.code,{children:"Header"}),"\u7c7b\u7528\u4e8e\u8bf7\u6c42\u5934\u53c2\u6570\u89e3\u6790\u8bfb\u53d6"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import Header\nfrom typing import Optional, List\n\n@router.get("/header", summary="\u89e3\u6790\u8bf7\u6c42\u5934\u53c2\u6570")\nasync def headertest(user_agent: Optional[str] = Header(None, convert_underscores=True),\n                     accept_encoding: Optional[str] = Header(None, convert_underscores=True),\n                     accept: Optional[str] = Header(None),\n                     accept_token: str = Header(..., convert_underscores=False), # \u81ea\u5b9a\u4e49\u8bf7\u6c42\u5934\n                     x_token: List[str] = Header(None, convert_underscores=False) # \u591a\u503c\u7684\u91cd\u540d\u8bf7\u6c42\u5934\n                     ):\n    return {\n        "user_name": user_agent,\n        "accept_encoding": accept_encoding,\n        "accept": accept,\n        "accept_token": accept_token,\n        "X-Token": x_token,\n    }\n'})}),"\n",(0,r.jsxs)(n.p,{children:["python\u7684\u53d8\u91cf\u540d\u4e2d\u4e0d\u80fd\u7528\u77ed\u6a2a\u6760\uff0c\u800c\u6d4f\u89c8\u5668\u4f20\u9012\u53c2\u6570\u7528\u7684\u90fd\u662f\u77ed\u6a2a\u6760\uff0c\u56e0\u6b64\u9700\u8981\u7528\u5230",(0,r.jsx)(n.code,{children:"Header"}),"\u7c7b\u7684",(0,r.jsx)(n.code,{children:"convert_underscores"}),"\u53c2\u6570\uff0c\u5176\u610f\u4e3a\uff1a\u5982\u679c\u5728\u89c6\u56fe\u51fd\u6570\u4e2d\u58f0\u660e\u7684\u8bf7\u6c42\u5934\u53c2\u6570\u4f7f\u7528\u4e86\u4e0b\u5212\u7ebf\u547d\u540d\u6cd5\uff0c\u90a3\u4e48\u662f\u5426\u5bf9\u4e0b\u5212\u7ebf\u8fdb\u884c\u8f6c\u6362\u3002",(0,r.jsx)(n.code,{children:"True"}),"\u8868\u793a\u8f6c\u6362\uff0c",(0,r.jsx)(n.code,{children:"False"}),"\u8868\u793a\u4e0d\u8f6c\u6362\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406cookie\u53c2\u6570",children:"\u5904\u7406cookie\u53c2\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import Cookie\nfrom starlette.responses import Response\nfrom typing import Optional\n\n@router.post("/cookie", summary="\u8bbe\u7f6ecookie")\ndef set_cookie(response: Response, username: str):\n    response.set_cookie(key="cookie1", value=f"{username}.2023")\n    return {"msg": "set cookie success"}\n\n@router.get("/cookie", summary="\u83b7\u53d6cookie")\nasync def get_cookie(cookie1: Optional[str] = Cookie(None)):\n    return {"cookie1": cookie1}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(96540);const t={},i=r.createContext(t);function a(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);